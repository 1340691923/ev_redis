import{f as p,g as $,h as j,i as O,r as _,o as f,c as y,j as e,n as m,a as l,w as o,t as i,k,b as q,l as L,E as b,m as G,p as H,q as F}from"./index-de26f036.js";import{g as J}from"./redis-6d2122df.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";const t=w=>(H("data-v-a3d420eb"),w=w(),F(),w),Q={class:"page-header"},W=t(()=>e("h2",null,"Redis 信息总览",-1)),X={class:"auto-refresh-section"},Y={key:0,class:"last-refresh-time"},Z=t(()=>e("span",{class:"time-label"},"最后刷新:",-1)),ee={class:"time-value"},se=t(()=>e("div",{class:"card-header"},[e("i",{class:"el-icon-monitor"}),e("span",null,"服务器信息")],-1)),ae={class:"info-item"},le=t(()=>e("span",{class:"label"},"Redis版本:",-1)),te={class:"value"},oe={class:"info-item"},ne=t(()=>e("span",{class:"label"},"操作系统:",-1)),ce={class:"value"},ie={class:"info-item"},de=t(()=>e("span",{class:"label"},"进程ID:",-1)),_e={class:"value"},re={class:"info-item"},ue=t(()=>e("span",{class:"label"},"运行模式:",-1)),he={class:"value"},ve=t(()=>e("div",{class:"card-header"},[e("i",{class:"el-icon-pie-chart"}),e("span",null,"内存信息")],-1)),pe={class:"info-item"},me=t(()=>e("span",{class:"label"},"已用内存:",-1)),fe={class:"value"},be={class:"info-item"},we=t(()=>e("span",{class:"label"},"内存峰值:",-1)),ge={class:"value"},ye={class:"info-item"},ke=t(()=>e("span",{class:"label"},"Lua内存:",-1)),xe={class:"value"},Re={class:"info-item"},Ie=t(()=>e("span",{class:"label"},"内存占用率:",-1)),Se={class:"value"},Ce=t(()=>e("div",{class:"card-header"},[e("i",{class:"el-icon-data-line"}),e("span",null,"状态信息")],-1)),Ve={class:"info-item"},$e=t(()=>e("span",{class:"label"},"客户端连接数:",-1)),ze={class:"value"},De={class:"info-item"},Me=t(()=>e("span",{class:"label"},"历史连接数:",-1)),Te={class:"value"},Le={class:"info-item"},Be=t(()=>e("span",{class:"label"},"历史命令数:",-1)),Ee={class:"value"},Ue={class:"info-item"},Ae=t(()=>e("span",{class:"label"},"运行时间:",-1)),Ke={class:"value"},Ne=t(()=>e("div",{class:"card-header"},[e("i",{class:"el-icon-key"}),e("span",null,"键值统计")],-1)),je={class:"table-wrapper"},Oe=t(()=>e("div",{class:"card-header"},[e("i",{class:"el-icon-document"}),e("span",null,"Redis信息全集")],-1)),qe={key:0,class:"search-info"},Ge={key:1,class:"mobile-search-info"},He={class:"table-wrapper"},Fe={__name:"index",setup(w){const c=p({}),x=p([]),g=p(""),R=p(!1),I=p("");p(!1);let h=null;const s=$(()=>L.sdk.IsMobile()),z=$(()=>Object.entries(c.value).map(([n,a])=>({key:n,value:a}))),S=$(()=>{if(!g.value)return z.value;const n=g.value.toLowerCase();return z.value.filter(a=>a.key.toLowerCase().includes(n)||a.value.toLowerCase().includes(n))}),B=n=>{if(!n)return"-";const a=Math.floor(n/86400),d=Math.floor(n%86400/3600),r=Math.floor(n%3600/60);return s.value?a>0?`${a}天${d}时`:d>0?`${d}时${r}分`:`${r}分钟`:`${a}天 ${d}小时 ${r}分钟`},E=n=>{const a=new Date(n),d=a.getHours().toString().padStart(2,"0"),r=a.getMinutes().toString().padStart(2,"0"),u=a.getSeconds().toString().padStart(2,"0");return`${d}:${r}:${u}`},D=async(n=!0)=>{try{const a=L.sdk.GetSelectEsConnID();console.log("获取Redis信息总览，连接ID:",a);const d=await J({es_connect:a,database:0});console.log("Redis信息总览响应:",d),d.code===0?(c.value=d.data.info||{},x.value=d.data.keyspace||[],I.value=E(new Date),n&&b.success("Redis信息获取成功")):b.error(d.msg||"获取Redis信息失败")}catch(a){console.error("获取Redis信息失败:",a),b.error("网络请求失败: "+a.message)}},U=n=>{n?(b.success("已开启自动刷新，每2秒刷新一次"),A()):(b.info("已关闭自动刷新"),M())},A=()=>{h&&clearInterval(h),h=setInterval(()=>{D(!1)},2e3)},M=()=>{h&&(clearInterval(h),h=null)};return j(()=>{console.log("Redis信息总览页面已挂载"),console.log("是否为移动设备:",s.value),D()}),O(()=>{M()}),(n,a)=>{const d=_("el-switch"),r=_("el-tooltip"),u=_("el-card"),C=_("el-col"),K=_("el-row"),v=_("el-table-column"),T=_("el-table"),N=_("el-input");return f(),y("div",{class:m(["redis-page",{"mobile-layout":s.value}])},[e("div",Q,[W,e("div",{class:m(["refresh-controls",{"mobile-controls":s.value}])},[e("div",X,[l(r,{content:"每2秒刷新一次",placement:"bottom",disabled:!R.value},{default:o(()=>[l(d,{modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=V=>R.value=V),size:s.value?"small":"default","active-text":"自动刷新","active-color":"#409eff",onChange:U},null,8,["modelValue","size"])]),_:1},8,["disabled"])]),I.value?(f(),y("div",Y,[Z,e("span",ee,i(I.value),1)])):k("",!0)],2)]),l(K,{gutter:s.value?10:20,class:"info-cards"},{default:o(()=>[l(C,{span:s.value?24:8,class:m({"mobile-col":s.value})},{default:o(()=>[l(u,{class:"info-card"},{header:o(()=>[se]),default:o(()=>[e("div",ae,[le,e("span",te,i(c.value.redis_version||"-"),1)]),e("div",oe,[ne,e("span",ce,i(c.value.os||"-"),1)]),e("div",ie,[de,e("span",_e,i(c.value.process_id||"-"),1)]),e("div",re,[ue,e("span",he,i(c.value.redis_mode||"-"),1)])]),_:1})]),_:1},8,["span","class"]),l(C,{span:s.value?24:8,class:m({"mobile-col":s.value})},{default:o(()=>[l(u,{class:"info-card"},{header:o(()=>[ve]),default:o(()=>[e("div",pe,[me,e("span",fe,i(c.value.used_memory_human||"-"),1)]),e("div",be,[we,e("span",ge,i(c.value.used_memory_peak_human||"-"),1)]),e("div",ye,[ke,e("span",xe,i(c.value.used_memory_lua_human||c.value.used_memory_lua||"-"),1)]),e("div",Re,[Ie,e("span",Se,i(c.value.used_memory_rss_human||"-"),1)])]),_:1})]),_:1},8,["span","class"]),l(C,{span:s.value?24:8,class:m({"mobile-col":s.value})},{default:o(()=>[l(u,{class:"info-card"},{header:o(()=>[Ce]),default:o(()=>[e("div",Ve,[$e,e("span",ze,i(c.value.connected_clients||"-"),1)]),e("div",De,[Me,e("span",Te,i(c.value.total_connections_received||"-"),1)]),e("div",Le,[Be,e("span",Ee,i(c.value.total_commands_processed||"-"),1)]),e("div",Ue,[Ae,e("span",Ke,i(B(c.value.uptime_in_seconds)),1)])]),_:1})]),_:1},8,["span","class"])]),_:1},8,["gutter"]),x.value.length>0?(f(),q(u,{key:0,class:"table-card"},{header:o(()=>[Ne]),default:o(()=>[e("div",je,[l(T,{data:x.value,stripe:"",size:s.value?"small":"default"},{default:o(()=>[l(v,{prop:"db",label:"数据库",width:s.value?80:void 0},null,8,["width"]),l(v,{prop:"keys",label:"Keys",width:s.value?80:void 0},null,8,["width"]),l(v,{prop:"expires",label:"过期",width:s.value?80:void 0},null,8,["width"]),l(v,{prop:"avg_ttl",label:"TTL",width:s.value?100:void 0},null,8,["width"])]),_:1},8,["data","size"])])]),_:1})):k("",!0),l(u,{class:"table-card"},{header:o(()=>[Oe]),default:o(()=>[e("div",{class:m(["search-container",{"mobile-search":s.value}])},[l(N,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=V=>g.value=V),placeholder:"搜索Key或Value...","prefix-icon":"el-icon-search",clearable:"",style:G({width:s.value?"100%":"300px"}),size:s.value?"small":"default"},null,8,["modelValue","style","size"]),s.value?k("",!0):(f(),y("span",qe,"共 "+i(S.value.length)+" 条记录",1)),s.value?(f(),y("div",Ge," 共 "+i(S.value.length)+" 条记录 ",1)):k("",!0)],2),e("div",He,[l(T,{data:S.value,stripe:"","max-height":s.value?300:400,size:s.value?"small":"default"},{default:o(()=>[l(v,{prop:"key",label:"Key",width:s.value?120:void 0,"show-overflow-tooltip":!0},null,8,["width"]),l(v,{prop:"value",label:"Value","show-overflow-tooltip":!0})]),_:1},8,["data","max-height","size"])])]),_:1})],2)}}},We=P(Fe,[["__scopeId","data-v-a3d420eb"]]);export{We as default};
